# crypton API

Rustでaxumフレームワークを用いてAPIの実装を行う。

## 仕様

ユーザはまず、IDに対して暗号、署名用公開鍵をPOSTし、既に登録されていなければ、新規登録成立となる。
登録後は登録用以外の全てのエンドポイントへのアクセスの際に、Authorizedヘッダーに署名鍵で署名したUUIDを含むJSONを送信し、サーバはこの署名を検証した上で処理を実行する。
UUIDは1度受信したら記録され、2回目以降は同じUUIDでのリクエストは処理しない。
自動生成のIDはすべてUUIDv4を用いる。

## DBバックエンド

柔軟に変えられるような想定をしたい。
一方、まずはSQLiteのみのサポートでも良いと思う。

## ストレージ

SQLiteやアイコン、画像などはS3互換のオブジェクトストレージに保存される。
SQLite、プロフィール画像のみは暗号化しないが、それ以外はすべて暗号化される。

## エンドポイント

- `/v1/user/{id}/keys`
  - GETで暗号、署名の公開鍵取得
  - POSTで更新またはユーザ登録
  - DELETEでユーザ削除
- `/v1/user/{id}/profile`
  - GETでプロフィール取得
  - POSTで編集
- `/v1/chat`
  - GETでチャットグループ一覧取得
  - POSTで新規チャットグループの作成
- `/v1/chat/{chat_id}`
  - GETでチャットグループのスレッド一覧
  - POSTで新規スレッドの作成
- `/v1/chat/{chat_id}/{thread_id}`
  - GETでスレッド名取得
  - POSTでスレッド名の変更
- `/v1/chat/{chat_id}/{thread_id}/message`
  - GETでメッセージ一覧
    - fromとuntilパラメータで取得する範囲を数量で指定できる（from=-30&until=-10は、最新から30件前〜10件前を取得）
  - POSTで新規メッセージ送信
